<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>海子诗歌集</title>
    <link rel="stylesheet" href="static/css/tailwind.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Hero Section -->
    <header class="min-h-screen flex flex-col justify-center items-center relative overflow-hidden">
        <!-- 海子照片背景 -->
        <div class="absolute inset-0">
            <img src="static/images/image-haizi.jpg" alt="海子" class="w-full h-full object-cover opacity-30 grayscale fade-bottom select-none pointer-events-none" draggable="false">
            <div class="absolute inset-0 bg-gradient-to-b from-gray-50/50 via-gray-50/30 to-gray-50/50"></div>
        </div>
        
        <!-- Subtle decorative elements -->
        <div class="absolute top-20 left-20 w-32 h-32 bg-blue-100 rounded-full opacity-30 blur-3xl"></div>
        <div class="absolute bottom-32 right-32 w-48 h-48 bg-purple-100 rounded-full opacity-20 blur-3xl"></div>
        
        <div class="text-center max-w-4xl mx-auto px-8 relative">
            <!-- Main title with Logo -->
            <div class="mb-8 opacity-0" style="animation: fadeInUp 1.2s ease-out 0.5s forwards;">
                <img src="https://pic1.imgdb.cn/item/685a505158cb8da5c86ad526.png" alt="海子诗歌集" class="mx-auto h-24 md:h-32 object-contain">
            </div>
            
            <!-- Elegant divider -->
            <div class="flex justify-center mb-8 opacity-0" style="animation: fadeInUp 0.8s ease-out 1s forwards;">
                <div class="w-24 h-px bg-gradient-to-r from-transparent via-gray-400 to-transparent"></div>
            </div>
            
            <!-- Subtitle -->
            <p class="text-xl md:text-2xl text-gray-600 font-light mb-12 leading-relaxed poem-font opacity-0" style="animation: fadeInUp 1s ease-out 1.3s forwards;">
                "诗歌是一种神秘的语言，它要求我们用心灵去感受世界的美好"
            </p>
            
            <!-- Scroll indicator -->
            <div class="opacity-0" style="animation: fadeInUp 0.8s ease-out 2s forwards;">
                <div class="animate-bounce">
                    <svg class="w-6 h-6 text-gray-400 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                    </svg>
                </div>
                <p class="text-sm text-gray-500 mt-2 font-light">向下探索诗歌</p>
            </div>
        </div>
    </header>

    <!-- 移动端搜索按钮 -->
    <div class="block md:hidden fixed top-6 right-6 z-30">
        <button id="mobile-search-toggle" class="glass-bg px-4 py-3 rounded-full text-gray-700 hover:text-gray-900 transition-all duration-300 hover:shadow-lg flex items-center">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
        </button>
        
        <!-- 移动端搜索输入框 -->
        <div id="mobile-search-input-container" class="hidden absolute top-full right-0 mt-2 w-80 max-w-sm">
            <div class="relative">
                <input 
                    type="text" 
                    id="mobile-search-input" 
                    placeholder="搜索诗歌..." 
                    class="w-full px-4 py-3 pl-12 pr-12 rounded-full border border-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:border-transparent glass-bg text-gray-800 poem-font text-sm"
                >
                <svg class="w-4 h-4 text-gray-400 absolute left-4 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <button id="mobile-clear-search" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 hidden">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- 桌面端搜索按钮 -->
    <div class="hidden md:block fixed top-6 right-6 z-20">
        <div id="search-container" class="transition-all duration-300">
            <!-- 搜索按钮状态 -->
            <button id="search-toggle" class="glass-bg px-4 py-3 rounded-full text-gray-700 hover:text-gray-900 transition-all duration-300 hover:shadow-lg flex items-center">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </button>
            
            <!-- 搜索输入状态 -->
            <div id="search-input-container" class="hidden flex items-center space-x-2">
                <div class="relative">
                    <input 
                        type="text" 
                        id="search-input" 
                        placeholder="寻觅一切,包括世界" 
                        class="w-64 px-4 py-3 pl-12 pr-10 rounded-full border border-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-300 focus:border-transparent glass-bg text-gray-800 poem-font text-sm"
                    >
                    <svg class="w-4 h-4 text-gray-400 absolute left-4 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    <button id="clear-search" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 hidden">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 诗歌列表 -->
    <main class="relative">
        <!-- 加载动画 -->
        <div id="loading" class="loading py-32">
            <div class="text-center">
                <div class="spinner mx-auto mb-4"></div>
                <p class="text-gray-500 font-light">正在加载诗歌...</p>
            </div>
        </div>

        <!-- 诗歌容器 -->
        <div id="poems-container" class="max-w-6xl mx-auto px-4 md:px-8 py-2 md:py-4 hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-4 lg:gap-5 auto-rows-fr">
                <!-- 诗歌卡片将通过 JavaScript 动态生成 -->
            </div>
        </div>

        <!-- 分页控件 -->
        <div id="pagination" class="pt-5 md:pt-7 pb-8 md:pb-12 hidden">
            <!-- 移动端分页 -->
            <div class="block md:hidden">
                <div class="flex justify-between items-center px-4 mb-4">
                    <button id="mobile-prev-btn" class="flex items-center justify-center w-12 h-12 bg-white/90 backdrop-blur rounded-full shadow-lg disabled:opacity-40 disabled:cursor-not-allowed transition-all duration-300">
                        <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    
                    <div class="flex flex-col items-center">
                        <p id="mobile-page-info" class="text-gray-700 font-medium text-lg poem-font"></p>
                        <p id="mobile-total-info" class="text-gray-500 text-sm"></p>
                    </div>
                    
                    <button id="mobile-next-btn" class="flex items-center justify-center w-12 h-12 bg-white/90 backdrop-blur rounded-full shadow-lg disabled:opacity-40 disabled:cursor-not-allowed transition-all duration-300">
                        <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- 移动端页面指示器 -->
                <div class="flex justify-center">
                    <div id="mobile-page-dots" class="flex space-x-2">
                        <!-- 页面点将动态生成 -->
                    </div>
                </div>
            </div>
            
            <!-- 桌面端分页 -->
            <div class="hidden md:flex flex-col items-center space-y-4">
                <!-- 主要分页控件 -->
                <div class="flex justify-center items-center space-x-4">
                    <button id="prev-btn" class="flex items-center px-6 py-3 bg-white/80 backdrop-blur text-gray-700 rounded-full hover:bg-white hover:shadow-lg transition-all duration-300 disabled:opacity-40 disabled:cursor-not-allowed font-medium">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        上一页
                    </button>
                    
                    <div id="page-numbers" class="flex space-x-2">
                        <!-- 页码按钮将动态生成 -->
                    </div>
                    
                    <button id="next-btn" class="flex items-center px-6 py-3 bg-white/80 backdrop-blur text-gray-700 rounded-full hover:bg-white hover:shadow-lg transition-all duration-300 disabled:opacity-40 disabled:cursor-not-allowed font-medium">
                        下一页
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- 页面信息和快速跳转 -->
                <div class="flex flex-row items-center justify-center space-x-6 text-sm">
                    <p id="current-info" class="text-gray-500 font-light"></p>
                    <div class="h-4 w-px bg-gray-300"></div>
                    <div class="flex items-center space-x-2">
                        <span class="text-gray-400">跳转至</span>
                        <input 
                            type="number" 
                            id="page-jump-input" 
                            class="w-14 px-2 py-1 text-center text-xs border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-gray-400 focus:border-transparent bg-white/80 backdrop-blur"
                            min="1"
                            placeholder="页"
                        >
                        <button 
                            id="page-jump-btn"
                            class="px-3 py-1 text-xs bg-gray-800 text-white rounded hover:bg-gray-700 transition-colors focus:outline-none focus:ring-1 focus:ring-gray-400"
                        >
                            GO
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-gray-50">
        <div class="max-w-6xl mx-auto px-8 py-16 text-center">
            <p class="text-lg text-gray-600 poem-font font-light italic mb-4">
                "活在这珍贵的人间，太阳强烈，水波温柔"
            </p>
            <p class="text-sm text-gray-400 font-light">
                —— 海子
            </p>
        </div>
    </footer>

    <!-- 引入诗歌数据和内容管理系统 -->
    <script src="static/js/poems-data.js"></script>
    <script src="static/js/content-manager.js"></script>
    <script src="static/js/search.js"></script>
    <script>
        // 页面逻辑
        class PoemPage {
            constructor() {
                this.isFirstLoad = true;
                this.initializeEventListeners();
                this.loadContent();
            }

            async loadContent() {
                try {
                    await contentManager.loadPoems();
                    this.renderCurrentPage();
                    this.hideLoading();
                } catch (error) {
                    console.error('加载内容失败:', error);
                    this.showError();
                }
            }

            renderCurrentPage() {
                const poems = contentManager.getCurrentPagePoems();
                const container = document.getElementById('poems-container').querySelector('.grid');
                
                container.innerHTML = '';
                
                poems.forEach((poem, index) => {
                    const poemCard = this.createPoemCard(poem, index);
                    container.appendChild(poemCard);
                });

                // 标记首次加载完成
                if (this.isFirstLoad) {
                    this.isFirstLoad = false;
                }

                this.updatePagination();
                this.updatePageInfo();
            }


            createPoemCard(poem, index) {
                const article = document.createElement('article');
                const animationClass = this.isFirstLoad ? 'card-appear' : '';
                article.className = `poem-card ${animationClass} glass-bg-premium rounded-xl overflow-hidden shadow-lg hover:shadow-2xl cursor-pointer group h-full`;
                article.onclick = () => window.location.href = contentManager.getPoemUrl(poem);

                article.innerHTML = `
                    <div class="relative overflow-hidden flex flex-col h-full">
                        <!-- 精美的图片区域 -->
                        <div class="h-48 relative group-hover:scale-105 transition-transform duration-700 overflow-hidden">
                            <img src="${poem.image}" 
                                 alt="${poem.title}" 
                                 class="w-full h-full object-cover">
                            <div class="absolute inset-0 bg-black/40"></div>
                            
                            <!-- 标题区域 -->
                            <div class="absolute inset-0 flex items-center justify-center text-center text-white">
                                <div>
                                    <h3 class="text-3xl md:text-4xl font-bold mb-4 tracking-tight poem-font drop-shadow-2xl" title="${poem.title}">
                                        ${this.formatTitle(poem.title)}
                                    </h3>
                                    
                                    <div class="flex justify-center mb-4">
                                        <div class="w-16 h-px bg-white/80"></div>
                                    </div>
                                    
                                    <p class="text-lg font-medium opacity-90 drop-shadow">${poem.section}</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 内容区域 - 使用flex-1使其填充剩余空间 -->
                        <div class="px-5 pt-3 pb-5 flex-1 flex flex-col">
                            <!-- 诗歌预览 - 设置固定高度区域 -->
                            <div class="poem-preview rounded-lg p-3 md:p-4 pt-2 mb-3 flex-1 flex items-start">
                                <div class="text-gray-700 leading-relaxed poem-font text-base md:text-lg font-light whitespace-pre-line overflow-hidden">
                                    ${this.getFirstFourLines(poem.preview)}
                                </div>
                            </div>
                            
                            <!-- 底部信息 - 固定在底部 -->
                            <div class="flex justify-end items-center mt-auto pt-2 border-t border-gray-100">
                                <div class="inline-flex items-center text-gray-700 group-hover:text-gray-900 transition-colors font-medium">
                                    <span class="mr-2">阅读全文</span>
                                    <svg class="w-4 h-4 group-hover:translate-x-1 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                return article;
            }

            getFirstFourLines(text) {
                if (!text) return '';
                
                // 按换行符分割，过滤空行
                const lines = text.split('\n').filter(line => line.trim());
                
                // 在手机端显示更少内容
                const isMobile = window.innerWidth < 768;
                const maxLines = isMobile ? 2 : 4;
                
                return lines.slice(0, maxLines).join('\n');
            }

            formatTitle(title) {
                if (!title || title.length <= 6) return title;
                
                // 如果标题超过6个字，在第4个字后插入换行
                const firstPart = title.substring(0, 4);
                const secondPart = title.substring(4);
                return `${firstPart}<br>${secondPart}`;
            }

            updatePagination() {
                const totalPages = contentManager.getTotalPages();
                const currentPage = contentManager.currentPage;
                
                // 更新移动端分页
                this.updateMobilePagination(currentPage, totalPages);
                
                // 更新桌面端分页
                this.updateDesktopPagination(currentPage, totalPages);
            }
            
            updateMobilePagination(currentPage, totalPages) {
                // 更新移动端上一页/下一页按钮
                const mobilePrevBtn = document.getElementById('mobile-prev-btn');
                const mobileNextBtn = document.getElementById('mobile-next-btn');
                
                if (mobilePrevBtn) {
                    mobilePrevBtn.disabled = currentPage === 1;
                    mobilePrevBtn.onclick = () => this.goToPage(currentPage - 1);
                }
                
                if (mobileNextBtn) {
                    mobileNextBtn.disabled = currentPage === totalPages;
                    mobileNextBtn.onclick = () => this.goToPage(currentPage + 1);
                }
                
                // 更新移动端页面信息
                const mobilePageInfo = document.getElementById('mobile-page-info');
                const mobileTotalInfo = document.getElementById('mobile-total-info');
                
                if (mobilePageInfo) {
                    mobilePageInfo.textContent = `第 ${currentPage} 页`;
                }
                
                if (mobileTotalInfo) {
                    mobileTotalInfo.textContent = `共 ${totalPages} 页 · ${contentManager.poems.length} 首诗歌`;
                }
                
                // 更新移动端页面指示器点
                const mobilePageDots = document.getElementById('mobile-page-dots');
                if (mobilePageDots) {
                    mobilePageDots.innerHTML = '';
                    
                    // 最多显示7个点，当前页居中
                    const maxDots = 7;
                    let startPage = Math.max(1, currentPage - Math.floor(maxDots / 2));
                    let endPage = Math.min(totalPages, startPage + maxDots - 1);
                    
                    // 调整起始页以确保显示正确数量的点
                    if (endPage - startPage + 1 < maxDots) {
                        startPage = Math.max(1, endPage - maxDots + 1);
                    }
                    
                    for (let i = startPage; i <= endPage; i++) {
                        const dot = document.createElement('button');
                        dot.className = `w-2 h-2 rounded-full transition-all duration-300 ${
                            i === currentPage 
                                ? 'bg-gray-700 w-6' 
                                : 'bg-gray-300 hover:bg-gray-400'
                        }`;
                        dot.onclick = () => this.goToPage(i);
                        mobilePageDots.appendChild(dot);
                    }
                }
            }
            
            updateDesktopPagination(currentPage, totalPages) {
                // 更新桌面端上一页/下一页按钮
                const prevBtn = document.getElementById('prev-btn');
                const nextBtn = document.getElementById('next-btn');
                
                if (prevBtn) {
                    prevBtn.disabled = currentPage === 1;
                }
                if (nextBtn) {
                    nextBtn.disabled = currentPage === totalPages;
                }
                
                // 更新页码按钮
                const pageNumbers = document.getElementById('page-numbers');
                if (pageNumbers) {
                    pageNumbers.innerHTML = '';
                    
                    const createPageButton = (pageNum, isActive = false, isEllipsis = false) => {
                        const button = document.createElement('button');
                        
                        if (isEllipsis) {
                            button.className = 'w-12 h-12 rounded-full text-gray-400 cursor-default font-medium flex items-center justify-center bg-white/40 backdrop-blur';
                            button.innerHTML = '<span class="leading-none">···</span>';
                            button.disabled = true;
                        } else {
                            button.className = `w-12 h-12 rounded-full transition-all duration-300 font-medium ${
                                isActive 
                                    ? 'bg-gray-900 text-white shadow-lg transform scale-110 ring-2 ring-gray-300' 
                                    : 'bg-white/80 backdrop-blur text-gray-700 hover:bg-white hover:shadow-md hover:scale-105 hover:ring-2 hover:ring-gray-200'
                            }`;
                            button.textContent = pageNum;
                            button.onclick = () => this.goToPage(pageNum);
                        }
                        
                        return button;
                    };
                    
                    // 桌面端分页逻辑
                    const showPages = this.calculateDesktopPaginationRange(currentPage, totalPages);
                    
                    showPages.forEach(item => {
                        if (item.type === 'page') {
                            pageNumbers.appendChild(createPageButton(item.number, item.number === currentPage));
                        } else if (item.type === 'ellipsis') {
                            pageNumbers.appendChild(createPageButton(0, false, true));
                        }
                    });
                }
            }

            calculateDesktopPaginationRange(currentPage, totalPages) {
                const result = [];
                
                if (totalPages <= 7) {
                    // 总页数不多，显示所有页码
                    for (let i = 1; i <= totalPages; i++) {
                        result.push({ type: 'page', number: i });
                    }
                    return result;
                }
                
                // 总页数较多时的智能分页策略
                const delta = 2; // 当前页前后各显示2页
                
                // 始终显示第1页
                result.push({ type: 'page', number: 1 });
                
                // 计算当前页周围的范围
                let startPage = Math.max(2, currentPage - delta);
                let endPage = Math.min(totalPages - 1, currentPage + delta);
                
                // 调整范围以确保显示足够的页码
                if (currentPage <= 4) {
                    // 当前页在前面时，多显示后面的页码
                    endPage = Math.min(totalPages - 1, 6);
                } else if (currentPage >= totalPages - 3) {
                    // 当前页在后面时，多显示前面的页码
                    startPage = Math.max(2, totalPages - 5);
                }
                
                // 在第1页后添加省略号（如果需要）
                if (startPage > 2) {
                    result.push({ type: 'ellipsis' });
                }
                
                // 添加中间的页码
                for (let i = startPage; i <= endPage; i++) {
                    result.push({ type: 'page', number: i });
                }
                
                // 在最后一页前添加省略号（如果需要）
                if (endPage < totalPages - 1) {
                    result.push({ type: 'ellipsis' });
                }
                
                // 始终显示最后一页（如果总页数大于1）
                if (totalPages > 1) {
                    result.push({ type: 'page', number: totalPages });
                }
                
                return result;
            }

            updatePageInfo() {
                const totalPages = contentManager.getTotalPages();
                const currentPage = contentManager.currentPage;
                const totalPoems = contentManager.poems.length;
                
                document.getElementById('current-info').textContent = 
                    `第 ${currentPage} / ${totalPages} 页 · 共 ${totalPoems} 首诗歌`;
                
                // 更新快速跳转输入框的max属性
                const jumpInput = document.getElementById('page-jump-input');
                jumpInput.setAttribute('max', totalPages);
                jumpInput.value = '';
            }

            goToPage(page) {
                if (contentManager.setCurrentPage(page)) {
                    this.renderCurrentPage();
                }
            }

            hideLoading() {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('poems-container').classList.remove('hidden');
                document.getElementById('pagination').classList.remove('hidden');
            }

            showError() {
                document.getElementById('loading').innerHTML = 
                    '<div class="text-center text-red-500 font-light">加载内容失败，请刷新页面重试</div>';
            }

            initializeEventListeners() {
                document.getElementById('prev-btn').onclick = () => {
                    this.goToPage(contentManager.currentPage - 1);
                };
                
                document.getElementById('next-btn').onclick = () => {
                    this.goToPage(contentManager.currentPage + 1);
                };

                // 快速跳转功能
                const jumpInput = document.getElementById('page-jump-input');
                const jumpBtn = document.getElementById('page-jump-btn');
                
                const handlePageJump = () => {
                    const pageNum = parseInt(jumpInput.value);
                    const totalPages = contentManager.getTotalPages();
                    
                    if (pageNum && pageNum >= 1 && pageNum <= totalPages) {
                        this.goToPage(pageNum);
                        jumpInput.value = '';
                    } else {
                        jumpInput.classList.add('border-red-400', 'ring-red-400');
                        setTimeout(() => {
                            jumpInput.classList.remove('border-red-400', 'ring-red-400');
                        }, 1000);
                    }
                };
                
                jumpBtn.onclick = handlePageJump;
                jumpInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        handlePageJump();
                    }
                });

                // 键盘导航
                document.addEventListener('keydown', (e) => {
                    // 如果焦点在输入框内，不响应箭头键导航
                    if (document.activeElement === jumpInput) return;
                    
                    if (e.key === 'ArrowLeft') {
                        this.goToPage(contentManager.currentPage - 1);
                    } else if (e.key === 'ArrowRight') {
                        this.goToPage(contentManager.currentPage + 1);
                    }
                });

                // 响应屏幕大小变化，重新渲染分页
                window.addEventListener('resize', () => {
                    this.updatePagination();
                });

                // 平滑滚动
                const scrollIndicator = document.querySelector('.animate-bounce').parentElement;
                scrollIndicator.onclick = () => {
                    document.getElementById('poems-container').scrollIntoView({ 
                        behavior: 'smooth' 
                    });
                };
            }
        }

        // 确保所有依赖加载完成后初始化页面
        function initializePage() {
            console.log('正在初始化页面...');
            
            // 检查依赖是否加载完成
            if (typeof contentManager === 'undefined') {
                console.log('等待 content-manager.js 加载...');
                setTimeout(initializePage, 100);
                return;
            }
            
            // 检查search.js是否加载完成
            if (typeof window.poemSearcher === 'undefined' || window.poemSearcher === null) {
                console.log('等待 search.js 加载...');
                setTimeout(initializePage, 100);
                return;
            }
            
            console.log('依赖加载完成，开始初始化...');
            window.poemPage = new PoemPage();
        }

        // 初始化页面
        document.addEventListener('DOMContentLoaded', () => {
            initializePage();
            
            // 10秒后强制隐藏加载状态（备用方案）
            setTimeout(() => {
                const loading = document.getElementById('loading');
                const container = document.getElementById('poems-container');
                const pagination = document.getElementById('pagination');
                
                if (loading && !loading.classList.contains('hidden')) {
                    console.warn('加载超时，强制显示内容');
                    loading.classList.add('hidden');
                    if (container) container.classList.remove('hidden');
                    if (pagination) pagination.classList.remove('hidden');
                }
            }, 10000);
            
            // 检查URL参数是否有搜索关键词
            const urlParams = new URLSearchParams(window.location.search);
            const searchQuery = urlParams.get('search') ? decodeURIComponent(urlParams.get('search')) : null;
            
            // 桌面端搜索功能初始化
            const searchToggle = document.getElementById('search-toggle');
            const searchInputContainer = document.getElementById('search-input-container');
            const searchInput = document.getElementById('search-input');
            const clearSearch = document.getElementById('clear-search');
            
            // 移动端搜索功能初始化
            const mobileSearchToggle = document.getElementById('mobile-search-toggle');
            const mobileSearchInputContainer = document.getElementById('mobile-search-input-container');
            const mobileSearchInput = document.getElementById('mobile-search-input');
            const mobileClearSearch = document.getElementById('mobile-clear-search');
            
            // 桌面端点击搜索按钮切换状态
            if (searchToggle) {
                searchToggle.addEventListener('click', () => {
                    searchToggle.classList.add('hidden');
                    searchInputContainer.classList.remove('hidden');
                    searchInput.focus();
                });
            }
            
            // 移动端点击搜索按钮切换状态
            if (mobileSearchToggle) {
                mobileSearchToggle.addEventListener('click', () => {
                    mobileSearchInputContainer.classList.toggle('hidden');
                    if (!mobileSearchInputContainer.classList.contains('hidden')) {
                        mobileSearchInput.focus();
                    }
                });
            }
            
            // 桌面端搜索输入事件
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    if (e.target.value.trim()) {
                        clearSearch.classList.remove('hidden');
                    } else {
                        clearSearch.classList.add('hidden');
                        if (window.poemSearcher) {
                            window.poemSearcher.clearSearch();
                        }
                    }
                });
                
                // 桌面端回车搜索
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && window.poemSearcher) {
                        window.poemSearcher.performSearch();
                    }
                });
            }
            
            // 移动端搜索输入事件
            if (mobileSearchInput) {
                mobileSearchInput.addEventListener('input', (e) => {
                    if (e.target.value.trim()) {
                        mobileClearSearch.classList.remove('hidden');
                    } else {
                        mobileClearSearch.classList.add('hidden');
                        if (window.poemSearcher) {
                            window.poemSearcher.clearSearch();
                        }
                    }
                });
                
                // 移动端回车搜索
                mobileSearchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && window.poemSearcher) {
                        // 将桌面端输入框的值同步到移动端
                        if (searchInput) {
                            searchInput.value = e.target.value;
                        }
                        window.poemSearcher.performSearch();
                    }
                });
            }
            
            // 桌面端清空搜索
            if (clearSearch) {
                clearSearch.addEventListener('click', () => {
                    if (window.poemSearcher) {
                        window.poemSearcher.clearSearch();
                    }
                    searchToggle.classList.remove('hidden');
                    searchInputContainer.classList.add('hidden');
                    clearSearch.classList.add('hidden');
                });
            }
            
            // 移动端清空搜索
            if (mobileClearSearch) {
                mobileClearSearch.addEventListener('click', () => {
                    mobileSearchInput.value = '';
                    if (searchInput) {
                        searchInput.value = '';
                    }
                    mobileClearSearch.classList.add('hidden');
                    if (window.poemSearcher) {
                        window.poemSearcher.clearSearch();
                    }
                });
            }
            
            // 点击外部关闭搜索框
            document.addEventListener('click', (e) => {
                if (!searchInputContainer.contains(e.target) && !searchToggle.contains(e.target)) {
                    if (!searchInput.value.trim()) {
                        searchToggle.classList.remove('hidden');
                        searchInputContainer.classList.add('hidden');
                        clearSearch.classList.add('hidden');
                    }
                }
            });
            
            // 如果URL中有搜索参数，自动执行搜索
            if (searchQuery && window.poemSearcher) {
                // 等待搜索器初始化
                setTimeout(() => {
                    // 检测是否为移动端
                    const isMobile = window.innerWidth < 768;
                    
                    if (isMobile && mobileSearchInput) {
                        // 移动端设置搜索值
                        mobileSearchInput.value = searchQuery;
                        if (mobileClearSearch) {
                            mobileClearSearch.classList.remove('hidden');
                        }
                    } else if (searchInput) {
                        // 桌面端设置搜索值
                        searchInput.value = searchQuery;
                        searchToggle.classList.add('hidden');
                        searchInputContainer.classList.remove('hidden');
                        clearSearch.classList.remove('hidden');
                    }
                    
                    window.poemSearcher.performSearch();
                    
                    // 清理URL参数
                    window.history.replaceState({}, document.title, window.location.pathname);
                }, 500);
            }
        });
    </script>
</body>
</html>